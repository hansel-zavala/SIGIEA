// datasource/db.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id               Int                @id @default(autoincrement())
  email            String             @unique
  password         String
  name             String?
  role             String             @default("admin")
  therapistProfile TherapistProfile?
  guardian         Guardian?
  createdLecciones Leccion[]
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
}

model Student {
  id                     Int       @id @default(autoincrement())
  fullName               String
  dateOfBirth            DateTime
  isActive               Boolean   @default(true)
  lugarNacimiento        String?
  direccion              String?
  institucionProcedencia String?
  recibioEvaluacion      Boolean   @default(false)
  resultadoEvaluacionUrl String?
  anoIngreso             DateTime  @default(now()) @map("a√±o_ingreso")
  zona                   Zona?
  jornada                Jornada?
  genero                 Genero?
  institutoIncluido      String?
  partidaNacimientoUrl   String?
  atencionGrupal         Boolean   @default(false)
  atencionIndividual     Boolean   @default(false)
  atencionPrevocacional  Boolean   @default(false)
  atencionDistancia      Boolean   @default(false)
  terapiaDomicilio       Boolean   @default(false)
  atencionVocacional     Boolean   @default(false)
  inclusionEscolar       Boolean   @default(false)
  educacionFisica        Boolean   @default(false)
  tipoSangre             TipoSangre?
  medicamentos           Medicamento[] @relation("MedicamentoToStudent")
  alergias               Alergia[]     @relation("AlergiaToStudent")
  therapist              TherapistProfile? @relation(fields: [therapistId], references: [id])
  therapistId            Int?
  therapySessions        TherapySession[]
  guardians              Guardian[]
  createdAt              DateTime          @default(now())
  updatedAt              DateTime          @updatedAt
}

model Guardian {
  id                      Int         @id @default(autoincrement())
  fullName                String
  direccionEmergencia     String?
  numeroIdentidad         String      @unique
  telefono                String
  parentesco              Parentesco
  copiaIdentidadUrl       String?
  observaciones           String?     @db.Text
  isActive                Boolean     @default(true)
  student                 Student     @relation(fields: [studentId], references: [id])
  studentId               Int
  user                    User?       @relation(fields: [userId], references: [id])
  userId                  Int?        @unique
  createdAt               DateTime    @default(now())
  updatedAt               DateTime    @updatedAt
}

model TherapistProfile {
  id                Int       @id @default(autoincrement())
  fullName          String
  identityNumber    String    @unique @map("numero_identidad")
  dateOfBirth       DateTime? @map("fecha_nacimiento")
  gender            Genero?
  phone             String?
  email             String    @unique
  specialty         ProfessionalType @map("tipo_profesional")
  hireDate          DateTime? @default(now()) @map("fecha_ingreso")
  identityCardUrl   String?   @map("copia_identidad_url")
  resumeUrl         String?   @map("curriculum_url")
  isActive          Boolean   @default(true)
  workStartTime     String    @default("08:00")
  workEndTime       String    @default("17:00")
  lunchStartTime    String    @default("12:00")
  lunchEndTime      String    @default("13:00")
  workDays          Json      @default("[1,2,3,4,5]")
  user              User      @relation(fields: [userId], references: [id])
  userId            Int       @unique
  assignedStudents  Student[]
  therapySessions   TherapySession[]
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

model TherapySession {
  id          Int      @id @default(autoincrement())
  startTime   DateTime
  endTime     DateTime
  status      SessionStatus @default(Programada)
  notes       String?  @db.Text
  behavior    String?  @db.Text
  progress    String?  @db.Text
  duration    Int      @default(45)
  student     Student  @relation(fields: [studentId], references: [id])
  studentId   Int
  therapist   TherapistProfile @relation(fields: [therapistId], references: [id])
  therapistId Int
  leccion     Leccion  @relation(fields: [leccionId], references: [id])
  leccionId   Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Leccion {
  id           Int      @id @default(autoincrement())
  title        String
  objective    String   @db.Text
  description  String?  @db.Text
  category     String?
  keySkill     String?
  isActive     Boolean  @default(true)
  createdBy    User     @relation(fields: [createdById], references: [id])
  createdById  Int
  therapySessions TherapySession[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Medicamento {
  id        Int       @id @default(autoincrement())
  nombre    String    @unique
  students  Student[] @relation("MedicamentoToStudent")

  @@map("medicamentos")
}

model Alergia {
  id        Int       @id @default(autoincrement())
  nombre    String    @unique
  students  Student[] @relation("AlergiaToStudent")

  @@map("alergias")
}

enum SessionStatus {
  Programada
  Completada
  Cancelada
  Ausente
}

enum Zona {
  Rural
  Urbano
}

enum Jornada {
  Matutina
  Vespertina
}

enum Genero {
  Masculino
  Femenino
}

enum Parentesco {
  Padre
  Madre
  Tutor_Legal
  Otro
}

enum ProfessionalType {
  Psicologo
  Terapeuta
  Ambos
}

enum TipoSangre {
  A_POSITIVO
  A_NEGATIVO
  B_POSITIVO
  B_NEGATIVO
  AB_POSITIVO
  AB_NEGATIVO
  O_POSITIVO
  O_NEGATIVO
}